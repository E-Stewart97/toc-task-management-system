<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: html(pageTitle='Admin Dashboard', content=~{::content})}">
<div th:fragment="content">
    <div class="container">
        <h2>Admin Dashboard - All Users and Content</h2>

        <div th:if="${users.isEmpty()}">
            <p>No users found in the system.</p>
        </div>

        <!-- Loop through each user -->
        <div th:each="user : ${users}" class="card user-section">
            <h3 class="user-header">
                User: <span th:text="${user.username}"></span>
                (<span th:text="${user.role}"></span>)
            </h3>

            <div th:if="${user.tocs.isEmpty()}">
                <p>This user has no TOCs.</p>
            </div>

            <!-- Loop through each TOC for the user -->
            <div th:each="toc : ${user.tocs}" class="toc-card-admin">
                <div class="toc-header">
                    <h4 th:text="${toc.title} + ' (' + ${toc.businessCode} + ')'">TOC Title (BC)</h4>
                    <form th:action="@{/admin/tocs/delete/{id}(id=${toc.id})}" method="post" class="confirm-delete"
                          data-confirm-message="ADMIN ACTION: Are you sure you want to delete this TOC?">
                        <button type="submit" class="delete-button">Delete TOC</button>
                    </form>
                </div>
                <ul>
                    <li th:each="task : ${toc.tasks}" class="task-item">
                        <div>
                            <span th:text="${task.title}">Task Title</span>
                            - <span th:text="${task.status}">Status</span>
                        </div>
                        <form th:action="@{/admin/tasks/delete/{id}(id=${task.id})}" method="post" class="confirm-delete"
                              data-confirm-message="ADMIN ACTION: Are you sure you want to delete this specific task?">
                            <button type="submit" class="delete-button-small">âœ–</button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
</html>